---
title: "Creating Dotplot"
author: "Abinet Joan"
date: "`r format (Sys.time(), format='%Y-%m-%d %H:%M:%S %z')`"
output:
  pdf_document:
    toc: true
    toc_depth: 2
  html_document: default
header-includes:
  - |
    ```{=latex}
    \usepackage{fvextra}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{
      breaksymbolleft={}, 
      showspaces = false,
      showtabs = false,
      breaklines,
      commandchars=\\\{\}
    }
    ```
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Loading package
```{r}
suppressMessages(library(ggplot2))
suppressMessages(library("forcats"))
suppressMessages(library(formatR))
```

# Function adapting the format of tsv file
```{r}
modify_GSEA_data <- function(GSEA_results){
  GSEA_results<- GSEA_results[order(GSEA_results$NES, decreasing = T),]
  
  GSEA_results$NAME <- gsub("_", " ", GSEA_results$NAME)
  GSEA_results$NAME <- substr(GSEA_results$NAME, start = 6, stop = nchar(GSEA_results$NAME))
  GSEA_results
}
```

The most relevant ontologies were selected and written in the file "Plot-gsea-Peri vs Intra.docx". The complete list of ontology are described in tsv files.

# Dotplot perilesional vs intralesional
```{r fig.width=8, fig.height=5}
# loading table
dir <- "../output/perivvsintra/"
# BP
GSEA_BP_res <- read.table(paste0(dir, "my_analysis.Gsea.1684311691666_BP2/gsea_report_for_perilesional_1684311691666.tsv"), header = T, sep = "\t")
GSEA_BP_res <- modify_GSEA_data(GSEA_BP_res)
GSEA_BP_res <- GSEA_BP_res[c(6,9,12,16,20,28,53),]

# MF
GSEA_MF_res <- read.table(paste0(dir, "my_analysis.Gsea.1684310907505_MF/gsea_report_for_perilesional_1684310907505.tsv"), header = T, sep = "\t")
GSEA_MF_res <- modify_GSEA_data(GSEA_MF_res)
GSEA_MF_res <- GSEA_MF_res[c(3,11),]

# CC
GSEA_CC_res <- read.table(paste0(dir, "my_analysis.Gsea.1684311503281_CC/gsea_report_for_perilesional_1684311503281.tsv"), header = T, sep = "\t")
GSEA_CC_res <- modify_GSEA_data(GSEA_CC_res)
GSEA_CC_res <- GSEA_CC_res[c(1,10,14,18),]

GSEA_Data <- rbind(GSEA_MF_res, GSEA_CC_res, GSEA_BP_res)
GSEA_Data <- GSEA_Data[order(GSEA_Data$NES, decreasing = F),]
row.names(GSEA_Data) <- NULL

# define the column has a factor so that the order of Ontology is maintain in the plot.
GSEA_Data$NAME <- factor(GSEA_Data$NAME, levels = GSEA_Data$NAME)

ggplot(GSEA_Data, aes(x = NES,y =NAME, size = SIZE, color = FDR.q.val)) + geom_point() + ggtitle("GSEA - Perilesional vs Intralesional") + scale_color_gradient(low = "red", high = "blue") + theme_bw()+ scale_size(range = c(3,10))
# ggsave("GSEA_PerivsIntra.pdf", width = 12, height = 8)
```

# Dotplot intralesional vs perilesional
```{r fig.width=8, fig.height=5}
# BP
GSEA_BP_res <- read.table(paste0(dir, "my_analysis.Gsea.1684311691666_BP2/gsea_report_for_intralesional_1684311691666.tsv"), header = T, sep = "\t")
GSEA_BP_res <- modify_GSEA_data(GSEA_BP_res)
GSEA_BP_res <- GSEA_BP_res[rev(rownames(GSEA_BP_res)),]
GSEA_BP_res <- GSEA_BP_res[c(1,2,21,78),]

# MF
GSEA_MF_res <- read.table(paste0(dir, "my_analysis.Gsea.1684310907505_MF/gsea_report_for_intralesional_1684310907505.tsv"), header = T, sep = "\t")
GSEA_MF_res <- modify_GSEA_data(GSEA_MF_res)
GSEA_MF_res <- GSEA_MF_res[rev(rownames(GSEA_MF_res)),]
GSEA_MF_res <- GSEA_MF_res[c(2,4,6),]

# CC
GSEA_CC_res <- read.table(paste0(dir, "my_analysis.Gsea.1684311503281_CC/gsea_report_for_intralesional_1684311503281.tsv"), header = T, sep = "\t")
GSEA_CC_res <- modify_GSEA_data(GSEA_CC_res)
GSEA_CC_res <- GSEA_CC_res[rev(rownames(GSEA_CC_res)),]
GSEA_CC_res <- GSEA_CC_res[c(2,3,5,9),]

GSEA_Data <- rbind(GSEA_MF_res, GSEA_CC_res, GSEA_BP_res)
GSEA_Data <- GSEA_Data[order(GSEA_Data$NES, decreasing = F),]
row.names(GSEA_Data) <- NULL

# define the column has a factor so that the order of Ontology is maintain in the plot.
GSEA_Data$NAME <- factor(GSEA_Data$NAME, levels = GSEA_Data$NAME)

ggplot(GSEA_Data, aes(x = NES,y =NAME, size = SIZE, color = FDR.q.val)) + geom_point() + ggtitle("GSEA - Intralesional vs Perilesional") + scale_color_gradient(low = "red", high = "blue") + theme_bw()+ scale_size(range = c(3,10))
#ggsave("GSEA_IntravsPeri.pdf", width = 12, height = 8)
```

```{r}
sessionInfo()
```

